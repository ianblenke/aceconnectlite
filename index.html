<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>ACE Connect Lite CA Desktop</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

        <!-- Bootstrap 3.3.5 -->
        <link rel="stylesheet" href="bower_components/AdminLTE/bootstrap/css/bootstrap.css">
	<!-- Bootstrap Toggle v2.2.0 -->
        <link rel="stylesheet" href="bower_components/bootstrap-toggle/css/bootstrap-toggle.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="bower_components/AdminLTE/dist/css/AdminLTE.css">
        <!-- AdminLTE Skins  -->
        <link rel="stylesheet" href="bower_components/AdminLTE/dist/css/skins/_all-skins.min.css">
        <!-- Custom Portal stylesheet -->
        <link rel="stylesheet" href="css/ca-portal.css">     
		
		<style>			
			.control-sidebar.control-sidebar-open, 
			.control-sidebar.control-sidebar-open + .control-sidebar-bg {
				right: 0 !important;
			}		
		</style>

    </head>
    <body class="hold-transition skin-purple sidebar-mini">
        <div class="wrapper">

            <header class="main-header">

                <!-- Logo -->
                <a href="" class="logo">
                    <!-- mini logo for sidebar mini 50x50 pixels -->
                    <span class="logo-mini"><b>ACE</b></span>
                    <!-- logo for regular state and mobile devices -->
                    <span class="logo-lg"><b>ACE</b>&nbsp;Connect Lite</span>
                </a>

                <!-- Header Navbar: style can be found in header.less -->
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                        <span class="sr-only">Toggle navigation</span>
                    </a>
                    <div id="callDuration" class="col-lg-4 col-md-4 col-sm-4 col-lg-offset-4 col-md-offset-4">
                        <label class="control-label">Call Duration: </label>&nbsp;&nbsp;<span id="duration" class="text-gray">0 sec</span>
                    </div>
                    <!-- Navbar Right Menu -->
                    <div class="navbar-custom-menu">
                        <ul class="nav navbar-nav">
                            <!-- User Account: style can be found in dropdown.less -->
                            <li class="dropdown user user-menu">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <img src="bower_components/AdminLTE/dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
                                    <span class="hidden-xs" id="agentname-header"></span>
                                </a>
                                <ul class="dropdown-menu">
                                    <!-- User image -->
                                    <li class="user-header">
                                        <img src="bower_components/AdminLTE/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                        <p>
                                            <span id="agentname-headerdropdown"></span>
											<br>
                                            <span id="agentrole-headerdropdown"></span>
                                        </p>
                                    </li>
                                    <!-- Menu Footer-->
                                    <li class="user-footer">
                                        <div class="pull-left">
                                            <a href="#" class="btn btn-default btn-flat">Profile</a>
                                        </div>
                                        <div class="pull-right">
                                            <a href="#" class="btn btn-default btn-flat">Sign out</a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                            <!-- Control Sidebar Toggle Button -->
                            <li>
                                <a href="#" data-toggle="modal" data-target="#licModal"><i class="fa fa-info-circle"></i></a>
                            </li>
			    <li>
                                <a href="#" data-toggle="control-sidebar"><i class="fa fa-gears"></i></a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>


            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    <div class="user-panel">
                        <div class="pull-left image">
                            <img src="bower_components/AdminLTE/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                        </div>
                        <div class="pull-left info">
                            <p><span id="agentname-sidebar"></span></p>
                            <span><i id="status-icon" class="fa fa-circle text-warning"></i></span>&nbsp;&nbsp;&nbsp;<span id="user-status">Away</span>
                        </div>
                    </div>
                    <!-- sidebar menu: : style can be found in sidebar.less -->
                    <ul class="sidebar-menu">
                        <li class="header">USER STATUS</li>
                            <li onclick="pauseQueues();"><a href="#"><i class="fa fa-circle text-yellow"></i> <span>Away</span></a></li>
                            <li onclick="unpauseQueues();"><a href="#"><i class="fa fa-circle text-green"></i> <span>Ready</span></a></li>
                        <li class="header">MAIN NAVIGATION</li>
                        <li class="active treeview">
                            <a href="#">
                                <i class="fa fa-desktop"></i> <span>CA Desktop</span>
                            </a>
                        </li>
                    </ul>
                </section>
                <!-- /.sidebar -->
            </aside>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>CA Desktop</h1>
                    <ol class="breadcrumb">
                        <li><a href="#"><i class="fa fa-desktop"></i> Home</a></li>
                        <li class="active">CA Desktop</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">
                    <!-- Main Row -->
                    <div class="row">
                        <section class= col-lg-12>
							<div class="row">
                                <div class="col-lg-12">
                                    <div class="form-group text-center">
										<input type="button" class="btn btn-success" id="btnOriginate" value="Connect Call" onclick='originate();' />
                                        <input type="hidden" name="destexten" id="destexten" value="">               
                                        <input type="button" class="btn btn-warning"  id="btnClear" value="Finished" onclick="finished();" />
									</div>
								</div>
							</div>										
							<div class="col-md-12">
								<div class="box">
									<div class="box-header with-border">
										<i class="fa fa-phone"></i>
										<h3 class="box-title">Call Information</h3>
										<div class="box-tools pull-right">
											<button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
										</div>
									</div><!-- /.box-header -->
									<div class="box-body" id="callinfodiv">
										<div class="row">
											<div class="col-lg-6">
												<label class="control-label">Inbound</label>
												<label id="inbounddhohlabel"><i class="fa fa-deaf"></i></label>
												<div>
													<label type="text" class="form-control" id="inboundnumber" />
												</div>
											</div>										
											<div class="col-lg-6">
												<label class="control-label">Outbound</label>
												<label id="outbounddhohlabel"><i class="fa fa-deaf"></i></label>
												<div>
													<label type="text" class="form-control" id="outboundnumber"/><!-- input text did not work -->
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>		
                            <div class="col-md-12">
                                <div class="box">
                                    <div class="box-header with-border">
                                        <i class="fa fa-user"></i>
                                        <h3 class="box-title">VRS Information</h3>
                                        <div class="box-tools pull-right">
                                            <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                                        </div>
                                    </div><!-- /.box-header -->
                                    <div class="box-body">
                                        <form name="userform" id="userform">
                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="control-label">First Name</label>
                                                        <div>
                                                            <input type="text" class="form-control" id="callerFirstName" name="fname" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Last Name</label>
                                                        <input type="text" class="form-control" id="callerLastName"/>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Unique ID</label>
                                                        <input type="text" class="form-control" id="callerUniqueID" disabled/>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="form-group">
                                                        <label class="control-label">Address Line 1</label>
                                                        <input type="text" class="form-control" id="callerAddress1"/>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="form-group">
                                                        <label class="control-label">Address Line 2</label>
                                                        <input type="text" class="form-control" id="callerAddress2" />
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="control-label">City/Town</label>
                                                        <input type="text" class="form-control" id="callerCity"/>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="control-label">State</label>
                                                        <input type="text" class="form-control" id="callerState"/>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Zip Code</label>
                                                        <input type="text" class="form-control" id="callerZipcode"/>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-lg-4">
                                                    <div class="form-group">
                                                        <label class="control-label">Phone</label>
                                                        <div>
                                                            <input type="text" class="form-control" id="callerPhone" name="phone"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-8">
                                                    <div class="form-group">
                                                        <label class="control-label">Email</label>
                                                        <div>
                                                            <input type="email" class="form-control" id="callerEmail" name="email" required/>
                                                        </div>
                                                    </div>
                                                </div>
											</div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                        </section>


                    </div><!-- /.row -->
                </section><!-- /.content -->
            </div><!-- /.content-wrapper -->

            <footer class="main-footer">
                <div class="pull-right hidden-xs">
                    <b>Version</b> 1.0
                </div>
                <strong>Copyright &copy; 2016.</strong> All rights reserved.
            </footer>

            <!-- Control Sidebar -->
            <aside class="control-sidebar control-sidebar-dark" style="width: 400px; right:-400px">
                <!-- Create the tabs -->
                <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
                    <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
                    <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
                    <li id="debugtab"><a href="#control-sidebar-debug-tab" data-toggle="tab"><i class="fa fa-bug"></i></a></li>
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <!-- Home tab content -->
					<div class="tab-pane" id="control-sidebar-home-tab"></div>
					<!-- Debug tab content -->
                    <div class="tab-pane" id="control-sidebar-debug-tab">
						<input type="button" class="btn btn-danger" id="btndbgclear" value="Clear Debug Text" onclick='cleardbgtxt();' />
						<br>
						<div id="dbgtxt" style='height:400px;max-height: 400px;overflow-y:scroll;'></div>
                    </div><!-- /.tab-pane -->

                    <!-- Settings tab content -->
                    <div class="tab-pane active" id="control-sidebar-settings-tab">
                        <div class="well">                            
                            <h2>
                                Call Agent Information
                            </h2>
                            <br />
                            <table style='width: 100%'>
                                <tr>
                                    <td>
                                        <label style="height: 100%">
                                            Display Name:
                                        </label>
                                    </td>
                                    <td>
                                        <input type="text" style="width: 100%; height: 100%" id="txtAgentDisplayName" value="" readonly placeholder="e.g. agent1" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label style="height: 100%">
                                            First Name:
                                        </label>
                                    </td>
                                    <td>
                                        <input type="text" style="width: 100%; height: 100%" id="txtAgentFirstname" value="" readonly  placeholder="e.g. John" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label style="height: 100%">
                                            Last Name:
                                        </label>
                                    </td>
                                    <td>
                                        <input type="text" style="width: 100%; height: 100%" id="txtAgentLastname" value="" readonly  placeholder="e.g. Doe" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label style="height: 100%">
                                            Role:
                                        </label>
                                    </td>
                                    <td>
                                        <input type="text" style="width: 100%; height: 100%" id="txtAgentRole" value=""  readonly  placeholder="e.g. call agent" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label style="height: 100%">Email:</label>
                                    </td>
                                    <td>
                                        <input type="text" style="width: 100%; height: 100%" id="txtAgentEmail" value=""  readonly placeholder="jDoe@email.com"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label style="height: 100%">Phone:</label>
                                    </td>
                                    <td>
                                        <input type="text" style="width: 100%; height: 100%" id="txtAgentPhone" value=""  readonly placeholder="e.g. 555-555-5555" />
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="padding:10px;text-align:center">
                                        <input type="button" class="btn btn-danger" id="btnLogout" value="LogOut" onclick='logout();' />
                                    </td>
                                </tr>
                            </table>
                        </div>

                    </div><!-- /.tab-pane -->
                </div>
            </aside><!-- /.control-sidebar -->
            <!-- Add the sidebar's background. This div must be placed
                 immediately after the control sidebar -->
            <div class="control-sidebar-bg" style="width:400px; right:-400px"></div>

        </div><!-- ./wrapper -->

        <!-- Glass Panel -->
        <div id='divGlassPanel' class='glass-panel' style='visibility:hidden'></div>

        <!-- Login Dialog -->
       <div class="modal fade"  data-backdrop="static"  id="loginModal" role="dialog" style="overflow-y:auto;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Sign In</h4>
                    </div>
                    <div class="modal-body">
                        <form>
                        <div class="form-horizontal" id='loginform'  >
                            <div class="row">
                                <div class='form-group'>
                                    <label class="control-label col-md-2" for="loginusername">Username</label>
                                    <div class="col-md-8">
                                        <input type="text" class="form-control" id="loginusername" name="loginusername" placeholder="enter username">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class='form-group'>
                                    <label class="control-label col-md-2" for="loginpassword">Password</label>
                                    <div class="col-md-8">
                                        <input type="password" class="form-control" id="loginpassword" name="loginpassword" placeholder="enter password">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class='form-group'>
                                    <label class="control-label col-md-2"></label>
                                    <div class="btn-group-vertical btn-group" role="group">
                                        <input type='submit' id="signinbtn" class="btn btn-primary" value="Sign in">
                                    </div>
                                </div>
                            </div>
                        </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <div class='form-group'>
                            <div class="checkbox col-md-8">
                                <div class="text-danger lead text-center" id="statusmsg">&nbsp;</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
	<!-- License Modal -->
	<div class="modal fade" id="licModal" tabindex="-1" role="dialog">
	    <div class="modal-dialog" role="document">
		<div class="modal-content">
		    <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			    <span aria-hidden="true">&times;</span>
			</button>
			<h4 class="modal-title" id="licModalLabel">Copyright Notices</h4>
		    </div>
		    <div class="modal-body">
			<div id="licModalBody"></div> 
		    </div>
		    <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		    </div>
		</div>
	    </div>
	</div>


    <!-- ==================Le javascript ================================ -->
	<!-- jQuery v2.1.4 -->
	<script src="bower_components/AdminLTE/plugins/jQuery/jquery-2.2.3.min.js"></script>
	<!-- socket.io-client -->
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<!-- Bootstrap 3.3.5 -->
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
	<!-- Decode JWT tokens -->
    <script type="text/javascript" src="bower_components/jwt-decode/build/jwt-decode.min.js"></script>
	<!-- timer.jquery 0.6.3 -->
	<script type="text/javascript" src='bower_components/timer.jquery/dist/timer.jquery.min.js'></script>
	<!--script type="text/javascript" src="bower_components/bootstrap/js/bootstrap-modal.js"></script-->
    <!--script type="text/javascript" src="bower_components/bootstrap/js/bootstrap-tooltip.js"></script-->
    <!-- AdminLTE App -->
    <script src="bower_components/AdminLTE/dist/js/app.min.js"></script>
	
    <script>
	var socket;
	var extensionMe;
	var queueNameMe;
	var channelMe;
	
	function connect_socket (data) {
            console.log('connect_socket');
            socket = io.connect('http://' + window.location.host, {
                query: 'token=' + data.token,
                forceNew: true
            });

            socket.on('connect', function () {
                console.log('authenticated');

                //get the payload form the token
                var payload = jwt_decode(data.token);
                $('#loginModal').modal('hide');
                $('#statusmsg').text(""); //clear status text
 
                //populate call agent information
                $('#txtAgentDisplayName').val(payload.username);
                $('#txtAgentFirstname').val(payload.first_name);
                $('#txtAgentLastname').val(payload.last_name);
                $('#txtAgentRole').val(payload.role);
                $('#txtAgentEmail').val(payload.email);
                $('#txtAgentPhone').val(payload.phone);
				
		$('#agentname-sidebar').html(payload.first_name + " " + payload.last_name);
		$('#agentname-header').html(payload.first_name + " " + payload.last_name);
		$('#agentname-headerdropdown').html(payload.first_name + " " + payload.last_name);
		$('#agentrole-headerdropdown').html("<small>"+payload.role+"</small>");

	        socket.emit('register-client', {"hello": "hello"});

                //TODO: get settings from SQL
                extensionMe = payload.extension; //e.g. 6001
                queueNameMe = payload.queue_name; //e.g. InboundQueue
                channelMe = payload.channel; //e.g. SIP/7001
                pauseQueues();

            }).on('disconnect', function () {
                console.log('disconnected');
                $('#loginModal').modal('show');
            }).on("unauthorized", function(error) {
                if (error.data.type === "UnauthorizedError" || error.data.code === "invalid_token") {
                    logout();
                    $('#statusmsg').text("Session has expired");
                }
            }).on('error', function (reason){
                logout();
                if(reason.code === "invalid_token")
                    $('#statusmsg').text("Session has expired");
            });

            // a new caller has connected
            socket.on('new-caller', function (data) {
			
				$('#dbgtxt').html('<span style="color:green">populate-destexten</span><br>' + JSON.stringify(data)+'<br>----------------<br>' + $('#dbgtxt').html());
				//filter out messages not destined for me
				if (data.id != extensionMe) {
					$('#dbgtxt').html('<br><span style="color:red">IGNORED -> new-caller: ' + data.id +  ', '+ extensionMe+'</span><br>' + $('#dbgtxt').html());
					return;
				}
				clearScreen();
		
                //alert(data);
                console.log("Received new-caller message");
                $('#callerFirstName').val(data.data[0].first_name);
                $('#callerLastName').val(data.data[0].last_name);
                $('#callerUniqueID').val(''); //set to blank for now
                $('#callerAddress1').val(data.data[0].address);
                $('#callerCity').val(data.data[0].city);
                $('#callerState').val(data.data[0].state);
                $('#callerZipcode').val(data.data[0].zip_code);
                $('#callerPhone').val(data.data[0].vrs);
                $('#callerEmail').val(data.data[0].email);
				
				$('#inboundnumber').text(data.srcPhoneNum);	
                $('#outboundnumber').text($('#destexten').val());		
                
				if (data.vrscaller) {
					$('#inbounddhohlabel').show();
                }else{
					$('#outbounddhohlabel').show();
				}
				
                $('#duration').timer('reset');
                inCall();
            });

            // Node is populating the out number hidden field
            socket.on('populate-destexten', function (data) {
                //alert(data);

				$('#dbgtxt').html('<span style="color:green">populate-destexten</span><br>' + JSON.stringify(data)+'<br>----------------<br>' + $('#dbgtxt').html());
				//filter out messages not destined for me
				if (data.id != extensionMe) {
					$('#dbgtxt').html('<br><span style="color:red">IGNORED -> populate-destexten: ' + data.id +  '</span><br>' + $('#dbgtxt').html());
					return;
				}

				
                $('#destexten').val(data.destexten);
				$('#outboundnumber').text(data.destexten);	
            });			

            socket.on('call-ended', function (data) {

				$('#dbgtxt').html('<span style="color:green">call-ended</span><br>' + JSON.stringify(data)+'<br>----------------<br>' + $('#dbgtxt').html());
				//filter out messages not destined for me
				if (data.id != extensionMe) {
					$('#dbgtxt').html('<br><span style="color:red">IGNORED -> call-ended: ' + data.id +  '</span><br>' + $('#dbgtxt').html());
					return;
				}
	
			
                console.log("Received call-ended message");
                //END TIMER
                $('#duration').timer('pause');
                pauseQueues();
                callWrapUp();
            });
			
        }

        $(document).on('click', '#signinbtn', function (e) {
            e.preventDefault();
            console.log();
            $.post('/login', {
                username: $('#loginusername').val(),
                password: $('#loginpassword').val()
            }).done(function (data) {
                if(data.token){
                    console.log(data);
                    connect_socket(data);
                }
                else{
                    $('#statusmsg').text(data.message);
                }
            });
        });

        function logout(){
            //clear the token from local storage
            window.localStorage.removeItem("accesstoken");
            //disconnect socket.io connection
            socket.disconnect();
            //display the login screen to the user.
            $('#loginModal').modal('show');
        }

        function inCall(){
            $('#user-status').text('In Call');
            $('#status-icon').removeClass("text-green");
            $('#status-icon').addClass("text-red");
            var param1 =  [{"Interface": "SIP/"+extensionMe,"Queue": ""}, {"Interface": "","Queue": ""}];
            socket.emit('pause-queues', param1);
        }

        function pauseQueues() {
            $('#user-status').text('Away');
            $('#status-icon').removeClass("text-green");
            $('#status-icon').addClass("text-yellow");

            socket.emit('pause-queues', null);
            socket.emit('away', null);
        }

        function unpauseQueues() {
            $('#user-status').text('Ready');
            $('#status-icon').removeClass("text-yellow");
            $('#status-icon').addClass("text-green");

            socket.emit('unpause-queues', null);
            socket.emit('ready', null);
        }
		function finished(){	
			$('#destexten').val('');
			clearScreen(); 
			unpauseQueues();
		}

        function clearScreen() {
            $('#userform').find('input:text').val('');
            $('#callerEmail').val('');
			
			$('#callinfodiv').find('input:text').val('');
			
			$('#inbounddhohlabel').hide();
			$('#outbounddhohlabel').hide();
			
			$('#outboundnumber').text('');
			$('#inboundnumber').text('');			
			
            $('#duration').timer('reset');
            $('#duration').timer('pause');
			
        }

        function originate() {
            //send username and number to call
            socket.emit('outbound-call', {"username": $('#loginusername').val(), "exten" : $('#destexten').val() }); //TODO: hard-coded exten for now
        }
		
		function cleardbgtxt(){
			$('#dbgtxt').html('');
			//$('#dbgtxt').html('<span style="color:green">call-ended</span><br>kjfsad fdlf sdlk jdslf lasf slfsdal slk skldjfsalfj alkfjsa lfj<br>----------------' + $('#dbgtxt').html());
			//$('#dbgtxt').html('<br><span style="color:red">IGNORED -> new-caller: </span><br>' + $('#dbgtxt').html());
		}
    
        $(document).ready(function () {
            $("#tdVideo").hide();
			$("#debugtab").hide();
			
            $("#incomingCallModal").modal("hide");

            clearScreen();

            $('#loginModal').modal('show');

            $.getJSON("licenses.json", function(data) {
                $.each(data.license, function(i){
                    $("#licModalBody").append("<h3>"+data.license[i].name+"<h3><pre>"+data.license[i].pre+"</pre>");
                });
            });
			
			if (window.addEventListener) {
				var state = 0, contra = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65];
				window.addEventListener("keydown", function (e) {
					if (e.keyCode == contra[state]){
						state++;
					}else{
						state = 0;
					}
					if (state == 10){						
						$("#debugtab").show();
					}
				}, true);
			}
        });

        </script>
    </body>
</html>
